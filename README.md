# Spring Boot gRPC Server

ì´ í”„ë¡œì íŠ¸ëŠ” **Spring Boot 3.x** ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„ëœ **HTTP(REST API)** ë° **gRPC** í”„ë¡œí† ì½œì„ ë™ì‹œì— ì§€ì›í•˜ëŠ” ë©€í‹° í”„ë¡œí† ì½œ ì„œë²„ì…ë‹ˆë‹¤.

## ğŸŒŸ í”„ë¡œì íŠ¸ ê°œìš”

íšŒì›(Member) ê´€ë ¨ ê¸°ëŠ¥ì„ REST APIì™€ gRPC ì„œë¹„ìŠ¤ í˜•íƒœë¡œ ëª¨ë‘ ì œê³µí•˜ë©°, ëŒ€ìš©ëŸ‰ í•„ë“œ(Base64 ì¸ì½”ë”© ì´ë¯¸ì§€ ë“±)ë¥¼ í™œìš©í•˜ì—¬ ì‹¤ì œ ìš´ì˜ í™˜ê²½ê³¼ ìœ ì‚¬í•œ íŠ¸ë˜í”½ ì‹œë®¬ë ˆì´ì…˜ì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ“š ê¸°ìˆ  ìŠ¤íƒ

- **Java 21**
- **Spring Boot 3.3.7**
- **Spring Security**
- **Spring Data JPA**
- **gRPC 1.65.1**
- **Protocol Buffers 4.28.2**
- **PostgreSQL**/H2 Database
- **JWT ì¸ì¦**
- **Docker** (ê°œë°œí™˜ê²½)

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Spring Boot Application                      â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 â”‚          â”‚                                â”‚   â”‚
â”‚  â”‚    REST API     â”‚          â”‚         gRPC Service           â”‚   â”‚
â”‚  â”‚  (Port: 8090)   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚         (Port: 50051)          â”‚   â”‚
â”‚  â”‚                 â”‚          â”‚                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                    â”‚                   â”‚
â”‚           â”‚                                    â”‚                   â”‚
â”‚           â–¼                                    â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 â”‚          â”‚                                â”‚   â”‚
â”‚  â”‚  Controller     â”‚          â”‚  gRPC Service Implementation   â”‚   â”‚
â”‚  â”‚  Layer          â”‚          â”‚  Layer                         â”‚   â”‚
â”‚  â”‚                 â”‚          â”‚                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                    â”‚                   â”‚
â”‚           â”‚                                    â”‚                   â”‚
â”‚           â–¼                                    â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â”‚                 Service Layer (Business Logic)              â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                 â”‚
â”‚                                  â”‚                                 â”‚
â”‚                                  â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â”‚              Repository Layer (Spring Data JPA)             â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                 â”‚
â”‚                                  â”‚                                 â”‚
â”‚                                  â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â”‚                    Database (PostgreSQL/H2)                 â”‚   â”‚
â”‚  â”‚                                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì‹œìŠ¤í…œ íë¦„ë„

```mermaid
sequenceDiagram
    participant Client as í´ë¼ì´ì–¸íŠ¸
    participant REST as REST API (8090)
    participant Service as ì„œë¹„ìŠ¤ ë ˆì´ì–´
    participant GRPC as gRPC ì„œë¹„ìŠ¤ (50051)
    participant Security as ë³´ì•ˆ ë ˆì´ì–´
    participant Repository as ë¦¬í¬ì§€í† ë¦¬
    participant DB as ë°ì´í„°ë² ì´ìŠ¤
    
    alt HTTP ìš”ì²­ íë¦„
        Client->>+REST: HTTP ìš”ì²­ (POST /api/members)
        REST->>Security: JWT í† í° ê²€ì¦ (í•„ìš”ì‹œ)
        Security-->>REST: ì¸ì¦ ê²°ê³¼
        REST->>+Service: íšŒì› ìƒì„± ìš”ì²­
        Service->>+Repository: íšŒì› ì—”í‹°í‹° ì €ì¥ ìš”ì²­
        Repository->>+DB: SQL ì¿¼ë¦¬ ì‹¤í–‰
        DB-->>-Repository: ê²°ê³¼ ë°˜í™˜
        Repository-->>-Service: ì €ì¥ëœ ì—”í‹°í‹° ë°˜í™˜
        Service-->>-REST: ì‘ë‹µ DTO ë°˜í™˜
        REST-->>-Client: HTTP ì‘ë‹µ (JSON)
    else gRPC ìš”ì²­ íë¦„
        Client->>+GRPC: gRPC ìš”ì²­ (GetMemberById)
        GRPC->>Security: gRPC ì¸í„°ì…‰í„° (í† í° ê²€ì¦)
        Security-->>GRPC: ì¸ì¦ ê²°ê³¼
        GRPC->>+Service: íšŒì› ì¡°íšŒ ìš”ì²­
        Service->>+Repository: íšŒì› ì—”í‹°í‹° ì¡°íšŒ ìš”ì²­
        Repository->>+DB: SQL ì¿¼ë¦¬ ì‹¤í–‰
        DB-->>-Repository: ê²°ê³¼ ë°˜í™˜
        Repository-->>-Service: ì¡°íšŒëœ ì—”í‹°í‹° ë°˜í™˜
        Service-->>-GRPC: Protocol Buffer ë©”ì‹œì§€ ë³€í™˜
        GRPC-->>-Client: gRPC ì‘ë‹µ (Protobuf)
    end
```

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

### 1. HTTP REST API (8090 í¬íŠ¸)

| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… | ì¸ì¦ í•„ìš” |
|--------|------|------|-----------|
| POST | `/api/members` | íšŒì› ìƒì„± | ì•„ë‹ˆì˜¤ |
| GET | `/api/members/{id}` | íšŒì› ì¡°íšŒ | ì˜ˆ |
| POST | `/api/auth/login` | ë¡œê·¸ì¸ (JWT í† í° ë°œê¸‰) | ì•„ë‹ˆì˜¤ |
| POST | `/api/auth/refresh` | í† í° ê°±ì‹  | ì˜ˆ |

### 2. gRPC ì„œë¹„ìŠ¤ (50051 í¬íŠ¸)

#### ì£¼ìš” ì„œë¹„ìŠ¤ ì •ì˜

```protobuf
service MemberService {
  // ìŠ¤íŠ¸ë¦¬ë° ê¸°ë°˜ íšŒì› ìƒì„± (ì–‘ë°©í–¥ ìŠ¤íŠ¸ë¦¬ë°)
  rpc StreamCreateMember (stream MemberRequest) returns (stream MemberCreateResponse);
  
  // íšŒì› IDë¡œ ì¡°íšŒ (ë‹¨ì¼ ìš”ì²­-ì‘ë‹µ)
  rpc GetMemberById (MemberIdRequest) returns (MemberResponse);
  
  // ì´ë©”ì¼ë¡œ íšŒì› ì¡°íšŒ (ë‹¨ì¼ ìš”ì²­-ì‘ë‹µ)
  rpc GetMemberByEmail (MemberEmailRequest) returns (MemberResponse);
}
```

#### ë©”ì‹œì§€ êµ¬ì¡°

- **MemberRequest**: íšŒì› ìƒì„± ìš”ì²­ ë°ì´í„°
- **MemberResponse**: íšŒì› ì •ë³´ ì‘ë‹µ ë°ì´í„°
- **MemberIdRequest**: ID ê¸°ì¤€ ì¡°íšŒ ìš”ì²­
- **MemberEmailRequest**: ì´ë©”ì¼ ê¸°ì¤€ ì¡°íšŒ ìš”ì²­

### 3. ë³´ì•ˆ ë° ì¸ì¦

#### JWT ê¸°ë°˜ ì¸ì¦

- ì‚¬ìš©ì ì¸ì¦ì„ ìœ„í•œ JWT í† í° ë°œê¸‰ ë° ê²€ì¦
- REST API ë° gRPC ëª¨ë‘ ë™ì¼í•œ JWT í† í° í™œìš©
- Spring Securityì™€ gRPC ì¸í„°ì…‰í„° ì—°ë™

#### ì„œë²„ ê°„ ì¸ì¦

- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ í†µì‹ ì„ ìœ„í•œ ì„œë²„ í† í° êµ¬í˜„
- í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ì˜ ë³´ì•ˆ í†µì‹ ì„ ìœ„í•œ ì¸ì¦ ê³„ì¸µ

### 4. ë°ì´í„° ëª¨ë¸

#### í•µì‹¬ ì—”í‹°í‹°

- **MemberEntity**: íšŒì› ê¸°ë³¸ ì •ë³´
  - id, email, password, name, profileImageBase64
- **Address**: íšŒì› ì£¼ì†Œ ì •ë³´ (ì„ë² ë””ë“œ)
- **Contact**: íšŒì› ì—°ë½ì²˜ ì •ë³´ (ì„ë² ë””ë“œ)
- **EtcInfo**: ë¶€ê°€ ì •ë³´ (JSON íƒ€ì… í¬í•¨)

## ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

```mermaid
erDiagram
    MEMBER {
        bigint id PK
        string email
        string password
        string name
        text profile_image_base64
    }
```

## ğŸ”„ gRPCì™€ REST API ë¹„êµ

| íŠ¹ì„± | gRPC | REST API |
|------|------|----------|
| í”„ë¡œí† ì½œ | HTTP/2 | HTTP/1.1 |
| ë°ì´í„° í¬ë§· | Protocol Buffers (ë°”ì´ë„ˆë¦¬) | JSON (í…ìŠ¤íŠ¸) |
| í†µì‹  ë°©ì‹ | ë‹¨ë°©í–¥, ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ìŠ¤íŠ¸ë¦¬ë°, ì–‘ë°©í–¥ ìŠ¤íŠ¸ë¦¬ë° | ìš”ì²­-ì‘ë‹µ |
| ì½”ë“œ ìƒì„± | ìë™ ìƒì„± (IDL ê¸°ë°˜) | ìˆ˜ë™ êµ¬í˜„ |
| íƒ€ì… ì•ˆì „ì„± | ê°•í•œ íƒ€ì… | ì•½í•œ íƒ€ì… |
| ì‚¬ìš© í™˜ê²½ | ì£¼ë¡œ ë‚´ë¶€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ í†µì‹  | ì™¸ë¶€ API ë…¸ì¶œ |

## ğŸ“ˆ ì„±ëŠ¥ íŠ¹ì„±

ì´ ì„œë²„ì˜ ì£¼ìš” ì„±ëŠ¥ íŠ¹ì„±:

1. **ë‚®ì€ ì§€ì—° ì‹œê°„**: gRPCì˜ HTTP/2 ê¸°ë°˜ í†µì‹ ìœ¼ë¡œ ì¸í•œ ë¹ ë¥¸ ì‘ë‹µ
2. **íš¨ìœ¨ì ì¸ ì§ë ¬í™”**: Protocol Buffersë¥¼ í†µí•œ ë°ì´í„° í¬ê¸° ìµœì†Œí™”
3. **ìŠ¤íŠ¸ë¦¬ë° ì§€ì›**: ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ë¥¼ ìœ„í•œ ì–‘ë°©í–¥ ìŠ¤íŠ¸ë¦¬ë°
4. **ë‹¤ì¤‘ ì—°ê²° ì²˜ë¦¬**: íš¨ìœ¨ì ì¸ ìŠ¤ë ˆë“œ í’€ ë° ë¹„ë™ê¸° ì²˜ë¦¬

## ğŸ› ï¸ ì„¤ì¹˜ ë° ì‹¤í–‰

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Java 21 ì´ìƒ
- Docker ë° Docker Compose (ì„ íƒì‚¬í•­)
- Gradle

### Dockerë¡œ PostgreSQL ì‹¤í–‰

```bash
# docker-compose.ymlì´ ìˆëŠ” ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰
docker-compose up -d
```

### ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ ë° ì‹¤í–‰

```bash
# í”„ë¡œì íŠ¸ ë¹Œë“œ
./gradlew clean build

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
java -jar build/libs/grpc-0.0.1-SNAPSHOT.jar
```

## ğŸ” API í…ŒìŠ¤íŠ¸

### REST API í…ŒìŠ¤íŠ¸

```bash
# íšŒì› ìƒì„±
curl -X POST http://localhost:8090/api/members \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123",
    "name": "Test User"
  }'

# ë¡œê·¸ì¸ ë° í† í° ë°œê¸‰
curl -X POST http://localhost:8090/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123"
  }'

# íšŒì› ì¡°íšŒ (ë°œê¸‰ë°›ì€ í† í° ì‚¬ìš©)
curl http://localhost:8090/api/members/1 \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9..."
```

### gRPC í…ŒìŠ¤íŠ¸ (ghz ì‚¬ìš©)

```bash
# íšŒì› ì¡°íšŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
ghz --insecure \
  --proto ./src/main/proto/member.proto \
  --call com.test.member.grpc.MemberService.GetMemberById \
  -d '{"id":1}' \
  -n 1000 \
  -c 50 \
  127.0.0.1:50051
```

## ğŸ”— ì—°ê³„ í”„ë¡œì íŠ¸

ì´ ì„œë²„ì™€ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í´ë¼ì´ì–¸íŠ¸ ì˜ˆì œ:
- [gRPC Client Example](https://github.com/wlsdks/grpc-client-example) - RESTì™€ gRPC ë™ì‹œ ì§€ì› í´ë¼ì´ì–¸íŠ¸